<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Customer Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body onload="checkCustomer();loadCatalogue()">

<div class="dashboard">
  <aside class="sidebar">
    <h2 class="neon-title">⚡ ElectroHub</h2>
    <a href="customer-dashboard.html" class="active">Dashboard</a>
    <a href="cart.html">Cart</a>
    <a href="orders.html">Orders</a>
    <a href="profile.html">Profile</a>
    <button onclick="logout()">Logout</button>
  </aside>

  <main class="main">
    <h1>Catalogue</h1>
    <input id="searchBox" placeholder="Search products..." oninput="loadCatalogue()">
    <select id="catFilter" onchange="loadCatalogue()">
      <option value="">All Categories</option>
      <option value="Smart Phone">Smart Phone</option>
      <option value="Laptop">Laptop</option>
      <option value="PC">PC</option>
      <option value="Smart Watch">Smart Watch</option>
      <option value="Tablets">Tablets</option>
    </select>

    <div id="catalogue" class="product-grid"></div>
  </main>
</div>

<script>
function checkCustomer(){
  const s = JSON.parse(localStorage.getItem("session") || "{}");
  if(!s.role || s.role !== "customer") location.href = "login.html";
}

function logout(){ localStorage.removeItem("session"); location.href="login.html"; }

function dynamicPrice(p){ let price = +p.price; if(p.stock<10) price*=1.05; if(p.stock>100) price*=0.95; return Math.round(price*100)/100; }

function loadCatalogue(){
  const q = document.getElementById("searchBox").value.toLowerCase();
  const cat = document.getElementById("catFilter").value;
  const products = JSON.parse(localStorage.getItem("products")||"[]");
  const catalogue = document.getElementById("catalogue");
  catalogue.innerHTML = "";

  products.filter(p=>p.status==="active" && p.name.toLowerCase().includes(q) && (!cat || p.category===cat))
    .forEach(p=>{
      catalogue.innerHTML += `
      <div class="card product-card">
        <img src="${p.image}" alt="${p.name}">
        <h4>${p.name}</h4>
        <p>₹${dynamicPrice(p)}</p>
        <button onclick="addToCart(${p.product_id})">Add to Cart</button>
      </div>`;
    });
}

function addToCart(id){
  let cart = JSON.parse(localStorage.getItem("cart") || "[]");
  cart.push(id);
  localStorage.setItem("cart", JSON.stringify(cart));
  alert("Product added to cart!");
}
</script>
</body>
</html>
